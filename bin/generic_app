#!/usr/bin/env ruby

require 'generic_app'

def get_input(default_value)
  value_input = gets.chomp
  if value_input == ''
    default_value
  else
    value_input
  end
end

puts '***********************'
puts 'Welcome to Generic App!'
puts

default_subdir = 'tmp9'
puts
puts "DEFAULT VALUE: #{default_subdir}"
puts 'Enter the directory name you wish to use for your generic app:'
subdir_name = get_input(default_subdir)
puts "You chose '#{subdir_name}'."
puts

default_email = 'please-change-me-at-config-initializers-devise@example.com'
puts "DEFAULT VALUE: #{default_email}"
puts "Enter the email address you wish to use for your generic app's mailer:"
email = get_input(default_email)

GenericApp.create_new(subdir_name, email)

puts '*********************************************'
puts "BEGIN TESTING THE #{subdir_name} RAILS APP"
system("cd #{subdir_name} && sh build_fast.sh")
puts "FINISHED TESTING THE #{subdir_name} RAILS APP"
puts '*********************************************'

puts "Your new Rails app has been created at #{ENV['PWD']}/#{subdir_name} ."
puts 'It is currently configured to use the SQLite database in the'
puts 'development environment.'
puts 'To set up the PostgreSQL database, enter the'
puts "#{ENV['PWD']}/#{subdir_name} directory and enter the command"
puts 'sh setup-pg.sh .'
puts 'Please note that the rails, pg, and nokogiri gems may be outdated.'
puts 'You should update these gem versions in the Gemfile.'
